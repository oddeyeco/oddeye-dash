function getmetainfo(b){$("#listtablediv").html("<img src='"+cp+"/assets/images/loading.gif' height='50px'> ");var a=cp+"/getmetastat";$.ajax({url:a,dataType:"json",type:"POST",beforeSend:function(c){c.setRequestHeader(header,token)},success:function(c){if(c.sucsses){$("#metrics").html(c.names);$("#typecount").html(c.types);$("#tags").html(c.tagscount);$("#count").html(c.count);$("#tagslist").html("");jQuery.each(c.tags,function(d,e){$("#tagslist").append('<div class="col-xl-3 col-sm-4 col-6"><a href="javascript:void(0)" class="showtags" data-toggle="modal" data-target="#exampleModal" value="'+d+'"><div class="tile_stats_count p-1 p-xl-2"><div class="tile_stats_inside"><span class="count_top"><i class="fa fa-th-list"></i> '+("{0}",d)+'</span><div class="row"><div class="col count spincrement">'+e+"</div></div></div></div></a></div>")});$(".spincrement").spincrement({duration:2000})}},error:function(e,c,d){getmetainfo()}})}var tablemeta=null;var tablelist=null;var maetricrow_regular_HTML="";var maetricrow_special_HTML="";var chartLinck="";var lang;function getmetatypes(b){var a=cp+"/gettypesinfo";$.ajax({url:a,dataType:"json",type:"POST",beforeSend:function(c){c.setRequestHeader(header,token)},success:function(e){if(e.sucsses){var d=$(b);for(var c in e.data){var f=e.data[c];d.append("<tr id=parent_"+c+" data-tt-id="+c+" key='type' value='"+f.value+"'><td><input type='checkbox' class='rawflat' name='table_records'></td><td>"+c+"</td><td class='count'> "+f.count+"  </td><td class='action text-right'><a href='javascript:void(0)' class='btn btn-outline-primary btn-sm showtagsl2' title_text='"+locale["metricinfo.metricsWithType"]+"' key='_type' value='"+f.value+"' valuetext='"+c+"'><i class='fa fa-list'></i> "+locale["metricinfo.showList"]+"</a>  <a href='javascript:void(0)' class='btn btn-outline-danger btn-sm ml-1 deletemetrics' key='_type' value='"+f.value+"'><i class='fa far fa-trash-alt'></i> "+locale["delete"]+"</a></td></tr>")}$("#listtable").find("td input.rawflat").iCheck({checkboxClass:icheckbox_flat_clr,radioClass:iradio_flat_clr});tablelist=$("#listtable").DataTable({language:lang,order:[[1,"asc"]],columnDefs:[{orderable:false,targets:[0,3]}]});$("#listtable").find("td input.rawflat").iCheck({checkboxClass:icheckbox_flat_clr,radioClass:iradio_flat_clr});tablelist.on("draw",function(){$("#listtable").find("td input.rawflat").iCheck({checkboxClass:icheckbox_flat_clr,radioClass:iradio_flat_clr})});$("#modall1").modal("show")}},error:function(e,c,d){$("#listtablediv").html("Loading Error")}})}function getmetanames(b){var a=cp+"/getmetricsnamesinfo";$.ajax({url:a,dataType:"json",type:"POST",beforeSend:function(c){c.setRequestHeader(header,token)},success:function(e){if(e.sucsses){var d=$(b);for(var c in e.dataspecial){var f=e.dataspecial[c];d.append("<tr id=parent_"+c+" data-tt-id="+c+" key='name' value='"+c+"'><td><input type='checkbox' class='rawflat' name='table_records'></td><td>"+c+"</td><td class='count'> "+f+"  </td><td class='action text-right'><a href='javascript:void(0)' class='btn btn-outline-primary btn-sm showtagsl2' title_text='"+locale["metricinfo.metricsWithName"]+"' key='_name' value='"+c+"'><i class='fa fa-list'></i> "+locale["metricinfo.showList"]+"</a>  <a href='javascript:void(0)' class='btn btn-outline-danger btn-sm ml-1 deletemetrics' key='_name' value='"+c+"'><i class='fa far fa-trash-alt'></i> "+locale["delete"]+"</a></td></tr>")}for(var c in e.dataregular){var f=e.dataregular[c];var d=$(b);d.append("<tr id=parent_"+c+" data-tt-id="+c+" key='name' value='"+c+"'><td><input type='checkbox' class='rawflat' name='table_records'></td><td>"+c+"</td><td class='count'> "+f+"  </td><td class='action text-right'><a href='javascript:void(0)' class='btn btn-outline-primary btn-sm showtagsl2' title_text='"+locale["metricinfo.metricsWithName"]+"' key='_name' value='"+c+"'><i class='fa fa-list'></i> "+locale["metricinfo.showList"]+"</a>  <a href='javascript:void(0)' class='btn btn-outline-danger btn-sm ml-1 deletemetrics' key='_name' value='"+c+"'><i class='fa far fa-trash-alt'></i> "+locale["delete"]+"</a></td></tr>")}$("#listtable").find("td input.rawflat").iCheck({checkboxClass:icheckbox_flat_clr,radioClass:iradio_flat_clr});tablelist=$("#listtable").DataTable({language:lang,order:[[1,"asc"]],columnDefs:[{orderable:false,targets:[0,3]}]});$("#listtable").find("td input.rawflat").iCheck({checkboxClass:icheckbox_flat_clr,radioClass:iradio_flat_clr});tablelist.on("draw",function(){$("#listtable").find("td input.rawflat").iCheck({checkboxClass:icheckbox_flat_clr,radioClass:iradio_flat_clr})});$("#modall1").modal("show")}},error:function(e,c,d){$("#listtablediv").html("Loading Error")}})}function getmetatags(b){var a=cp+"/gettagvalue?key="+b;$.ajax({url:a,dataType:"json",type:"POST",beforeSend:function(c){c.setRequestHeader(header,token)},success:function(c){if(c.sucsses){jQuery.each(c.data,function(f,g){var e=new RegExp("[//.|///]","g");var d=f.replace(e,"_");var h=b+"_"+d;h=h.replace(e,"_");$("#listtable").append("<tr id=parent_"+d+" data-tt-id="+d+" key='"+b+"' value='"+f+"'><td><input type='checkbox' class='rawflat' name='table_records'></td><td>"+f+"</td><td class='count'> "+g+"</td><td class='action text-right'><a href='javascript:void(0)' class='btn btn-outline-primary btn-sm showtagsl2' title_text='"+locale["metricinfo.metricsWithTag"]+"' key='"+b+"' value='"+f+"'><i class='fa fa-list'></i> "+locale["metricinfo.showList"]+"</a><a href='javascript:void(0)' class='btn btn-outline-danger btn-sm ml-1 deletemetrics' key='"+b+"' value='"+f+"'><i class='fa far fa-trash-alt'></i> "+locale["delete"]+"</a></td></tr>")});tablelist=$("#listtable").DataTable({language:lang,order:[[1,"asc"]],columnDefs:[{orderable:false,targets:[0,3]}]});$("#listtable").find("td input.rawflat").iCheck({checkboxClass:icheckbox_flat_clr,radioClass:iradio_flat_clr});tablelist.on("draw",function(){$("#listtable").find("td input.rawflat").iCheck({checkboxClass:icheckbox_flat_clr,radioClass:iradio_flat_clr})});$("#modall1").modal("show")}},error:function(e,c,d){$("#listtablediv").html("Loading Error")}})}function getmetrics(c,d,e,a){var b=cp+"/getmetrics?key="+c+"&value="+d;$.getJSON(b,function(n){var l="";if(a){for(var i in n.data){var h=n.data[i];if(h.type!==0){var j=maetricrow_regular_HTML}else{var j=maetricrow_special_HTML}var m=j.replace("{metricname}",h.name);if(h.type!==0){var o=chartLinck.replace("{hash}",h.hash);m=m.replace("{icons}",o)}else{m=m.replace("{icons}","")}var f="";for(var g in h.tags){var p=h.tags[g];f=f+"<div>"+g+':"'+p+'"</div>'}m=m.replace("{tags}",f);m=m.replace(new RegExp("{hash}","g"),h.hash);m=m.replace("{type}",JSON.stringify(h.typename));m=m.replace("{lasttime}",moment(h.lasttime).format("YYYY-MM-DD HH:mm:ss"));m=m.replace("{firsttime}",moment(h.inittime).format("YYYY-MM-DD HH:mm:ss"));m=m.replace("{livedays}",h.livedays);m=m.replace("{silencedays}",h.silencedays);l=l+m}$("#"+e).find("tbody").append(l);tablemeta=$("#"+e).DataTable({language:lang,order:[[1,"asc"]],columnDefs:[{orderable:false,targets:[0,8]}]});$("#"+e).find("td input.rawflat").iCheck({checkboxClass:icheckbox_flat_clr,radioClass:iradio_flat_clr});tablemeta.on("draw",function(){$("#"+e).find("td input.rawflat").iCheck({checkboxClass:icheckbox_flat_clr,radioClass:iradio_flat_clr})});tmphide=false;$("#modall1").modal("hide");$("#modall2").modal("show")}})}tmphide=true;$(document).ready(function(){lang={processing:locale["dataTable.processing"],search:locale["dataTable.search"],lengthMenu:locale["dataTable.lengthMenu"],info:locale["dataTable.info"],infoEmpty:locale["dataTable.infoEmpty"],infoFiltered:locale["dataTable.infoFiltered"],infoPostFix:locale["dataTable.infoPostFix"],loadingRecords:locale["dataTable.loadingRecords"],zeroRecords:locale["dataTable.zeroRecords"],emptyTable:locale["dataTable.emptyTable"],paginate:{first:locale["dataTable.paginate.first"],previous:locale["dataTable.paginate.previous"],next:locale["dataTable.paginate.next"],last:locale["dataTable.paginate.last"]},aria:{sortAscending:locale["dataTable.aria.sortAscending"],sortDescending:locale["dataTable.aria.sortDescending"]}};maetricrow_regular_HTML='<tr class="metricinfo" id={hash}><td class="icons text-nowrap"><input type="checkbox" class="rawflat" name="table_records">{icons}<a href="'+cp+'/history/{hash}" target="_blank"><i class="fa fa-history" style="font-size: 18px;"></i></a></td><td><a href="'+cp+'/metriq/{hash}">{metricname}</a></td><td class="tags">{tags} </td><td class="text-nowrap">{type}</td><td class="text-nowrap">{firsttime}</td><td class="text-nowrap">{lasttime}</td> <td class="text-nowrap">{livedays}</td><td class="text-nowrap">{silencedays}</td><td class="text-nowrap text-right"><a href="javascript:void(0)" class="btn btn-outline-primary btn-sm clreg" value="{hash}"> '+locale["metricinfo.clearRegression"]+' </a><a href="javascript:void(0)" class="btn btn-outline-danger btn-sm ml-1 deletemetric" value="{hash}"><i class="fa far fa-trash-alt"></i> '+locale["delete"]+" </a></td></tr>";maetricrow_special_HTML='<tr class="metricinfo" id={hash}><td class="icons text-nowrap"><input type="checkbox" class="rawflat" name="table_records">{icons}<a href="'+cp+'/history/{hash}" target="_blank"><i class="fa fa-history" style="font-size: 18px;"></i></a></td><td><a href="'+cp+'/metriq/{hash}">{metricname}</a></td><td class="tags">{tags} </td><td class="text-nowrap">{type}</td><td class="text-nowrap">{firsttime}</td><td class="text-nowrap">{lasttime}</td> <td class="text-nowrap">{livedays}</td><td class="text-nowrap">{silencedays}</td><td class="text-nowrap text-right"><a href="javascript:void(0)" class="btn btn-outline-danger btn-sm ml-1 deletemetric" value="{hash}"><i class="fa far fa-trash-alt"></i> '+locale["delete"]+" </a></td></tr>";chartLinck='<a href="'+cp+'/chart/{hash}" target="_blank"><i class="fa fas fa-chart-area" style="font-size: 18px;"></i></a>';getmetainfo();$("body").on("hidden.bs.modal","#modall2",function(a){$("#modall1").modal("show");tmphide=true});$("body").on("hidden.bs.modal","#modall1",function(a){if(tmphide){getmetainfo()}});$("body").on("click",".showtags",function(){$("#modall1").find(".modal-body").html("");$("#modall1").find(".modal-body").append('<div id="listtablediv" class="table-responsive"><table id="listtable" class="table table-striped table-bordered dt-responsive nowrap" cellspacing="0" width="100%"><thead><tr><th><input type="checkbox" class="rawflat checkall" name="table_records"> </th><th>'+locale.name2+"</th><th>"+locale.count+'</th><th><a href="#" class="deletemetriclistgroup btn btn-outline-danger btn-sm float-right"><i class="fa far fa-trash-alt"></i> '+locale.deleteSelected+'</a></th></tr> </thead><tbody class="text-center"></tbody> </table></div>');$("#listtable th input.checkall").iCheck({checkboxClass:icheckbox_flat_clr,radioClass:iradio_flat_clr});$("#listtable th input.checkall").on("ifChecked",function(){$(this).parents("table").find("td .rawflat").iCheck("check")});$("#listtable th input.checkall").on("ifUnchecked",function(){$(this).parents("table").find("td .rawflat").iCheck("uncheck")});var a=$(this).attr("value");if(!a){$("#modall1").find(".modal-title").text(locale.metricsList);getmetanames("#listtable")}else{if(a==="_name"){$("#modall1").find(".modal-title").text(locale.metricsList);getmetanames("#listtable")}else{if(a==="_type"){$("#modall1").find(".modal-title").text(locale.typesList);getmetatypes("#listtable")}else{$("#modall1").find(".modal-title").text(locale["metricinfo.tagList"].replace("{0}",a));getmetatags(a)}}}});$("body").on("click",".showtagsl2",function(){var a=[$(this).attr("key"),$(this).attr("value"),$(this).attr("valuetext")];var d=replaceArgumets($(this).attr("title_text"),a);$("#modall2").find(".modal-title").text(d);$("#modall2").find(".modal-body").html("");var b=$(this).attr("key");var c=$(this).attr("value");$("#modall2").find(".modal-body").append('<div id="listtablediv" class="table-responsive"><table id="listtable2" class="table table-striped table-bordered dt-responsive nowrap" cellspacing="0" width="100%"><thead><tr><th><input type="checkbox" class="rawflat checkall" name="table_records"> <div class="btn-group"><button type="button" class="btn btn-outline-success btn-sm dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button><ul class="dropdown-menu" role="menu"><li><a href="#" class="Show_chart">'+locale["metricinfo.showChart"]+'</a></li><li class="divider"></li><li><a href="#" class="Clear_reg">'+locale["metricinfo.clearRegression"]+"</a></li></ul></div></th><th>"+locale.name2+"</th><th>"+locale.tags+"</th><th>"+locale["adminlist.type"]+"</th><th>"+locale.firstTime+"</th> <th>"+locale.lastTime+"</th><th>"+locale.aliveDays+"</th><th>"+locale.silenceDays+'</th><th><a href="#" class="deletemetricgroup btn btn-outline-danger btn-sm float-right"><i class="fa far fa-trash-alt"></i> '+locale.deleteSelected+'</a></th></tr> </thead><tbody class="text-center"></tbody> </table></div>');getmetrics(b,c,"listtable2",true);$("#listtable2 th input.checkall").iCheck({checkboxClass:icheckbox_flat_clr,radioClass:iradio_flat_clr});$("#listtable2 th input.checkall").on("ifChecked",function(){$(this).parents("table").find("td .rawflat").iCheck("check")});$("#listtable2 th input.checkall").on("ifUnchecked",function(){$(this).parents("table").find("td .rawflat").iCheck("uncheck")})});$("body").on("click",".deletemetriclistgroup",function(a){$(this).parents("table").find("td input:checked").parents("tr").each(function(){if(tablelist){$.getJSON(cp+"/deletemetrics?key="+$(this).find(".deletemetrics").attr("key")+"&value="+$(this).find(".deletemetrics").attr("value"),function(b){});tablelist.row($(this)).remove()}});if(tablelist){tablelist.draw(false);$(this).parents("table").find("th .checkall").iCheck("uncheck")}});$("body").on("click",".deletemetricgroup",function(a){$(this).parents("table").find("td input:checked").parents("tr").each(function(){if(tablemeta){$.getJSON(cp+"/deletemetrics?hash="+$(this).find(".deletemetric").attr("value"),function(b){});tablemeta.row($(this)).remove()}});if(tablemeta){tablemeta.draw(false);$(this).parents("table").find("th .checkall").iCheck("uncheck")}});$("body").on("click",".deletemetrics",function(){if(tablelist){tablelist.row($(this).parents("tr")).remove();tablelist.draw(false)}$.getJSON(cp+"/deletemetrics?key="+$(this).attr("key")+"&value="+$(this).attr("value"),function(a){})});$("body").on("click",".deletemetric",function(){if(tablemeta){tablemeta.row($(this).parents("tr")).remove();tablemeta.draw(false)}$.getJSON(cp+"/deletemetrics?hash="+$(this).attr("value"),function(a){})});$("body").on("click",".clreg",function(){var a={};a.hash=$(this).parents("tr").attr("id");var d=$("meta[name='_csrf_header']").attr("content");var c=$("meta[name='_csrf']").attr("content");var b=cp+"/resetregression";$.ajax({dataType:"json",type:"POST",url:b,data:a,beforeSend:function(e){e.setRequestHeader(d,c)}}).done(function(e){if(e.sucsses){}else{console.log("Request failed")}}).fail(function(e,f){console.log("Request failed")})});$("body").on("click",".Show_chart",function(){hashes="";if($(this).parents("table").find("tbody input[name='table_records']:checked").length===1){hashes="/"+$(this).parents("table").find("tbody input[name='table_records']:checked").first().parents("tr").attr("id")}else{hashes="?hashes=";$(this).parents("table").find("tbody input[name='table_records']:checked").each(function(){hashes=hashes+$(this).parents("tr").attr("id")+";"})}var a=window.open(cp+"/chart"+hashes,"_blank");a.focus()});$("body").on("click",".Clear_reg",function(){$(this).parents("table").find("tbody input[name='table_records']:checked").each(function(){var a={};a.hash=$(this).parents("tr").attr("id");var d=$("meta[name='_csrf_header']").attr("content");var c=$("meta[name='_csrf']").attr("content");var b=cp+"/resetregression";$.ajax({dataType:"json",type:"POST",url:b,data:a,beforeSend:function(e){e.setRequestHeader(d,c)}}).done(function(e){if(e.sucsses){setTimeout(function(){location.reload()},1000)}else{console.log("Request failed")}}).fail(function(e,f){console.log("Request failed")})})})});